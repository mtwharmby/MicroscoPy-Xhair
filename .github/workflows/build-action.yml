name: Build MicroscoPy-Xhair

on: [workflow_dispatch]

jobs:
    build:
        
        runs-on: windows-latest
        
        steps:
            - uses: actions/checkout@v3
            - name: Setup Python-3.11
              uses: actions/setup-python@v4
              with:
                # We want to support 3.11 as this is what we know works!
                python-version: "3.11"
            
            - name: Install Poetry
              uses: abatilo/actions-poetry@v2

            - name: Install dependencies
              # run: C:\Users\runneradmin\.local\bin\poetry install --with dev
              run: poetry install --with dev

            - name: Build package
              # run: C:\Users\runneradmin\.local\bin\poetry build
              run: poetry build

            - name: Build Windows executables
              # run: C:\Users\runneradmin\.local\bin\poetry run python run_pyinstaller.py
              run: poetry run python run_pyinstaller.py
            
            - name: Save python artifacts
              uses: actions/upload-artifact@v3
              with:
                name: python-artifacts
                path: |
                  dist/microscopy_xhair-0.1.1.tar.gz
                  dist/microscopy_xhair-0.1.1-py3-none-any.whl
            - name: Save portable executable
              uses: actions/upload-artifact@v3
              with:
                name: windows-portable-executable
                path: dist/MicroscoPyXhair.exe
            - name: Save Windows redistributable
              uses: actions/upload-artifact@v3
              with:
                name: windows-redistributable-archive
                path: dist/MicroscoPyXhair.zip


